<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image Shape Art â€” Jack Mauro</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="compStyle.css">

  <!-- p5 -->
  <script src="libraries/p5.min.js"></script>
  <script src="libraries/p5.sound.min.js"></script>
</head>
<body>
  <a class="skip-link" href="#tool">Skip to content</a>

  <!-- Navbar gets injected here -->
  <header id="navbar"></header>

  <!-- Hero -->
  <section class="hero">
    <div class="hero-inner">
      <h1>Image Shape Art</h1>
      <p class="sub">Upload an image and rebuild it using geometric shapes. Tweak size, rotation, outlines, fills, colour variation, and background.</p>
    </div>
    <div class="hero-accent" aria-hidden="true"></div>
  </section>

  <!-- Tool -->
  <main id="tool" class="tool-wrap">
    <div class="tool-grid">
      <!-- Controls -->
      <section class="panel">
        <div class="panel-head">
          <h2 class="panel-title">Controls</h2>
          <div class="panel-actions">
            <button id="homeButton" class="btn btn-ghost" type="button" onclick="history.back()">Back to Portfolio</button>
            <button id="infoButton" class="btn btn-ghost" type="button">Information</button>
          </div>
        </div>

        <div class="field">
          <label for="imageInput">Input image</label>
          <input type="file" id="imageInput" accept="image/*">
        </div>

        <div class="field">
          <label for="shapeSelect">Select shape</label>
          <select id="shapeSelect">
            <option value="square">Square</option>
            <option value="triangle">Triangle</option>
            <option value="circle">Circle</option>
            <option value="all">All</option>
          </select>
        </div>

        <div class="field two-col">
          <div>
            <label for="sizeRange">Size of shapes</label>
            <input type="number" id="sizeRange" min="1" max="100" value="20">
          </div>
          <div>
            <label for="colourVariation">Colour variation</label>
            <input type="number" id="colourVariation" min="0" max="100" value="0">
          </div>
        </div>

        <fieldset class="field switches">
          <legend>Options</legend>
          <label class="chk"><input type="checkbox" id="randomizeSize"> Random sizes</label>
          <label class="chk"><input type="checkbox" id="rotation"> Rotation</label>
          <label class="chk"><input type="checkbox" id="outlines"> Outlines</label>
          <label class="chk"><input type="checkbox" id="fill"> Fill empty spaces</label>
        </fieldset>

        <div class="field two-col">
          <div>
            <label for="backgroundColor">Background colour</label>
            <input type="color" id="backgroundColor" value="#000000">
          </div>
          <div class="align-end">
            <label class="chk" for="backgroundImage">
              <input type="checkbox" id="backgroundImage"> Use original image as background
            </label>
          </div>
        </div>

        <div class="actions">
          <button id="startButton" class="btn">Start</button>
          <button id="download" class="btn btn-outline">Download</button>
        </div>
      </section>

      <!-- Canvas area -->
      <section class="panel">
        <div class="panel-head">
          <h2 class="panel-title">Canvas</h2>
        </div>
        <div id="canvasContainer" class="canvas-shell" aria-live="polite"></div>
      </section>
    </div>
  </main>

  <footer class="site-footer">
    <p>&copy; 2025 Jack Mauro. All rights reserved.</p>
  </footer>

  <!-- Info Modal -->
  <div class="modal" id="overlay" aria-hidden="true" role="dialog" aria-labelledby="modalTitle" aria-describedby="projectInfo">
    <div class="modal__backdrop" data-close-modal></div>
    <div class="modal__dialog" role="document">
      <button class="modal__close" aria-label="Close" id="closeOverlay" data-close-modal>&times;</button>
      <header class="modal__header">
        <h3 id="modalTitle">How to use</h3>
      </header>
      <div class="modal__body" id="projectInfo">
        <ol>
          <li>Upload an image using the 'Input image' button.</li>
          <li>Choose a shape (or <em>All</em> to mix).</li>
          <li>Set <em>Size</em>, optional <em>Colour variation</em>, and toggles (Random sizes, Rotation, Outlines, Fill).</li>
          <li>Pick a background colour or use the original image as the background.</li>
          <li>Press <strong>Start</strong> to generate. Use <strong>Download</strong> to save.</li>
        </ol>
      </div>
    </div>
  </div>

  <!-- Your sketch logic (unchanged) -->
  <script src="testAllFinal.js"></script>

  <!-- Page wiring: navbar fallbacks + logo fix + canvas parenting + info modal -->
  <script>
    // ===== Helper: try multiple relative paths until one fetches navbar.html =====
    async function loadNavbar() {
      const candidates = [
        "navbar.html",
        "Comp creativity/navbar.html",
        "../../navbar.html",
        "../../../navbar.html",
      ];
      for (const path of candidates) {
        try {
          const res = await fetch(path);
          if (res.ok) {
            const html = await res.text();
            document.getElementById("navbar").innerHTML = html;

            // Prefix used for this successful fetch (e.g. "../")
            const prefix = path.replace("navbar.html", "");

            // Wire mobile toggle + active link
            const btn = document.querySelector(".nav-toggle");
            const menu = document.getElementById("mainmenu");
            btn?.addEventListener("click", () => {
              const expanded = btn.getAttribute("aria-expanded") === "true";
              btn.setAttribute("aria-expanded", String(!expanded));
              menu.classList.toggle("open");
            });
            const current = (window.location.pathname.split("/").pop() || "").toLowerCase();
            document.querySelectorAll(".menu a").forEach(a => {
              const href = (a.getAttribute("href") || "").toLowerCase();
              if (href === current) { a.classList.add("active"); a.setAttribute("aria-current", "page"); }
            });

            // Fix brand logo path if it's relative like "images/logo.png"
            const logo = document.querySelector(".brand-logo") ||
                         document.querySelector('img[alt*="logo" i]');
            if (logo) {
              const src = logo.getAttribute("src") || "";
              const isAbsolute = /^(data:|https?:|\/)/i.test(src);
              if (!isAbsolute) logo.src = prefix + src.replace(/^\.\/+/, "");
            }

            return; // success
          }
        } catch (e) { /* try next */ }
      }
      console.warn("navbar.html not found in expected locations.");
    }
    loadNavbar();

    // ===== Info modal open/close =====
    (function () {
      const overlay = document.getElementById("overlay");
      const openInfo = document.getElementById("infoButton");
      const closeBtns = overlay.querySelectorAll("[data-close-modal]");
      const escClose = (e) => { if (e.key === "Escape") close(); };
      function open() {
        overlay.setAttribute("aria-hidden", "false");
        document.body.style.overflow = "hidden";
        document.addEventListener("keydown", escClose);
      }
      function close() {
        overlay.setAttribute("aria-hidden", "true");
        document.body.style.overflow = "";
        document.removeEventListener("keydown", escClose);
      }
      openInfo.addEventListener("click", open);
      closeBtns.forEach(b => b.addEventListener("click", close));
      overlay.querySelector(".modal__backdrop").addEventListener("click", close);
    })();

    // ===== Move any p5 canvas into #canvasContainer =====
    (function () {
      const shell = document.getElementById("canvasContainer");
      function moveExisting() {
        const c = document.querySelector("canvas.p5Canvas, canvas");
        if (c && !shell.contains(c)) {
          shell.classList.add("has-canvas");
          shell.appendChild(c);
        }
      }
      // Move if already present
      moveExisting();
      // Watch for newly created canvases
      const mo = new MutationObserver(() => moveExisting());
      mo.observe(document.documentElement, { childList: true, subtree: true });
    })();
  </script>
</body>
</html>
